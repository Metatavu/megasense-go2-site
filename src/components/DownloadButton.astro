---
import { Image } from "astro:assets";

type Props = {
  title: string;
  icon?: ImageMetadata;
  dense?: boolean;
  className?: string;
  altText?: string;
};

const { title, icon, className, dense, altText } = Astro.props;

---

<download-button>
  <a
    class="download-button rounded-full bg-go2-blue text-[#fff] flex flex-row gap-2 md:hover:cursor-pointer"
    class:list={[
      dense ? "px-4 h-6" : "px-6 py-3 uppercase",
      className,
    ]}
  >
    {title}
    {icon && <Image src={icon} alt={altText || ""}/>}
    </a>
</download-button>

<script>
  class DownloadButton extends HTMLElement {
    constructor() {
      super();

      const button = this.querySelector(".download-button");

      button?.addEventListener("click", () => {
        redirectAppStore();
      });

      /**
       * Redirects to device specific app store
       */
      const redirectAppStore = () => {
        const isAppleDevice = /iPhone|iPad|iPod|Macintosh/i.test(navigator.userAgent);
        const isAndroid = /Android|Linux/i.test(navigator.userAgent);

        if (isAppleDevice) {
          // TODO: Replace with app link when available
          window.open("https://apps.apple.com", "_blank");
        } else if (isAndroid) {
          // TODO: Replace with app link when available
          window.open("https://play.google.com", "_blank");
        }
        // TODO: Add fallback for other devices
      }
    }
  }
  customElements.define("download-button", DownloadButton);
</script>
